#@ load("@ytt:library", "library")
#@ load("@ytt:template", "template")

#@ kpack = library.get("github.com/pivotal/kpack")
--- #@ template.replace(kpack.eval())
--- #! explanation: the blobstore's sidecar needs to accept plain text connections from kpack build init containers.
    #! see https://github.com/cloudfoundry/capi-k8s-release/issues/12
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: cf-blobstore-allow-plaintext
  namespace: cf-blobstore
spec:
  selector:
    matchLabels:
      app: minio
  mtls:
    mode: PERMISSIVE
